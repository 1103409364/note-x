<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vite+Vue2+TS | Note-x</title>
    <meta name="description" content="Note-x with vitePress">
    <link rel="stylesheet" href="/note-x/assets/style.0a62fa9c.css">
    <link rel="modulepreload" href="/note-x/assets/Home.bed64c99.js">
    <link rel="modulepreload" href="/note-x/assets/app.81ce267e.js">
    <link rel="modulepreload" href="/note-x/assets/frontEnd_Vue_ViteVue2TS.md.51a24954.lean.js">
    
    <link rel="icon" href="/favicon.ico">
  <meta name="twitter:title" content="Vite+Vue2+TS | Note-x">
  <meta property="og:title" content="Vite+Vue2+TS | Note-x">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme"><header class="nav-bar" data-v-675d8756><div class="sidebar-button" data-v-675d8756><svg class="icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z" class></path></svg></div><a class="nav-bar-title" href="/note-x/" aria-label="Note-x, back to home" data-v-675d8756 data-v-cc01ef16><img class="logo" src="/note-x/OneNote.svg" alt="Logo" data-v-cc01ef16> Note-x</a><div class="flex-grow" data-v-675d8756></div><div class="nav" data-v-675d8756><nav class="nav-links" data-v-675d8756 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>前端</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/HTML/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>HTML</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/CSS/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>CSS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Javascript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Javascript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/note-x/frontEnd/Vue/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Vue</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/browser/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>浏览器</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Network/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>网络</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Security/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>安全</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>其他</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/others/markdown/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Markdown</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/others/vitepress/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>VitePress</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/1103409364/note-x" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav></div><!--[--><!--]--></header><aside class="sidebar" data-v-83e92a68><nav class="nav-links nav" data-v-83e92a68 data-v-eab3edfe><!--[--><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>前端</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/HTML/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>HTML</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/CSS/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>CSS</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Javascript/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Javascript</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item active" href="/note-x/frontEnd/Vue/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Vue</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/browser/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>浏览器</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Network/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>网络</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/frontEnd/Security/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>安全</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><div class="item" data-v-eab3edfe><div class="nav-dropdown-link" data-v-eab3edfe data-v-56bf3a3f><button class="button" data-v-56bf3a3f><span class="button-text" data-v-56bf3a3f>其他</span><span class="right button-arrow" data-v-56bf3a3f></span></button><ul class="dialog" data-v-56bf3a3f><!--[--><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/others/markdown/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>Markdown</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><li class="dialog-item" data-v-56bf3a3f><div class="nav-dropdown-link-item" data-v-56bf3a3f data-v-bbc27490><a class="item" href="/note-x/others/vitepress/" data-v-bbc27490><span class="arrow" data-v-bbc27490></span><span class="text" data-v-bbc27490>VitePress</span><span class="icon" data-v-bbc27490><!----></span></a></div></li><!--]--></ul></div></div><!--]--><!----><div class="item" data-v-eab3edfe><div class="nav-link" data-v-eab3edfe data-v-b8818f8c><a class="item isExternal" href="https://github.com/1103409364/note-x" target="_blank" rel="noopener noreferrer" data-v-b8818f8c>GitHub <svg class="icon outbound" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-b8818f8c><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div></nav><!--[--><!--]--><ul class="sidebar-links" data-v-83e92a68><!--[--><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/HTML/">HTML</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/HTML/basic">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/HTML/advanced">进阶</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/CSS/">CSS</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/CSS/">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/CSS/advanced">进阶</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Javascript/">Javascript</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Javascript/Javascript基础">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Javascript/Javascript进阶">进阶</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Javascript/问题记录">问题记录</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Vue/">Vue</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item active" href="/note-x/frontEnd/Vue/ViteVue2TS">Vite+Vue2+TS</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#基础配置">基础配置</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#模板-资源">模板&amp;资源</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#支持-setup-语法糖">支持 setup 语法糖</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#sass-配置">Sass 配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置全局-scss-变量">配置全局 scss 变量</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#mockjs-配置">mockjs 配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#国际化">国际化</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#图标">图标</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#配置-element-ui">配置 element-ui</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#vite-问题记录">vite 问题记录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#不支持的">不支持的</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#生态">生态</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#代码规范">代码规范</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#composition-api-实践">Composition API 实践</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#该用-ref-还是-reactive">该用 ref 还是 reactive</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#重置表单">重置表单</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#调用子组件方法">调用子组件方法</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#组件之间状态共享">组件之间状态共享</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#如何使用全局方法、路由、vuex">如何使用全局方法、路由、Vuex</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#composable">composable</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#vue2-typescript-实践">Vue2 TypeScript 实践</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#typescript-怎么声明全局类型">TypeScript 怎么声明全局类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#用-type-还是-interface？">用 type 还是 interface？</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#类型声明文件">类型声明文件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#volar-ts-在-vue-中提供更好的类型提示">Volar + TS 在 vue 中提供更好的类型提示</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#组件-props-类型校验">组件 props 类型校验</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#shims-vue-d-ts-文件的作用">shims-vue.d.ts 文件的作用</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#为-axios-增加泛型的支持">为 axios 增加泛型的支持</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#扩展-axios-config">扩展 axios config</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#自定义指令">自定义指令</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#导入-export-default-的文件">导入 export default 的文件</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#el-在-element-类型中不存在">$el 在 element 类型中不存在</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#eventtarget-类型">EventTarget 类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#隐式具有“any”类型">隐式具有“any”类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#获取对象所有的值的联合类型">获取对象所有的值的联合类型</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#模板过滤器问题">模板过滤器问题</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#其他问题">其他问题</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#tsx-实践">TSX 实践</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#配置-vite">配置 vite</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#遇到的问题">遇到的问题</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#ie-兼容">IE 兼容</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#js-兼容配置">js 兼容配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#css-兼容配置">css 兼容配置</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#element-ui-在-ie11-中报错">Element ui 在 ie11 中报错</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#svgicon-兼容性问题">svgIcon 兼容性问题</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#vueuse-实践">vueUse 实践</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#父子组件数据同步">父子组件数据同步</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#获取鼠标位置">获取鼠标位置</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="#打包上线">打包上线</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="#根据环境变量与模式打包项目">根据环境变量与模式打包项目</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#项目部署公共基础路径">项目部署公共基础路径</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#vite-config-js-中使用-import-meta-u200b-env">vite.config.js 中使用 import.meta\u200b.env.*</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#html-中使用环境变量">html 中使用环境变量</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="#打包文件路径">打包文件路径</a><!----></li></ul></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Vue/Vue踩坑记录">Vue 踩坑记录</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Vue/ElementUI2踩坑记录">ElementUI2 踩坑记录</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/browser/">浏览器</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/browser/">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/browser/advanced">进阶</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Network/">网络</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Network/">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Network/advanced">进阶</a><!----></li></ul></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Security/">安全</a><ul class="sidebar-links"><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Security/">基础</a><!----></li><li class="sidebar-link"><a class="sidebar-link-item" href="/note-x/frontEnd/Security/advanced">进阶</a><!----></li></ul></li><!--]--></ul><!--[--><!--]--></aside><div class="sidebar-mask"></div><main class="page" data-v-7eddb2c4><div class="container" data-v-7eddb2c4><!--[--><!--]--><div style="position:relative;" class="content" data-v-7eddb2c4><div><h1 id="vite-vue2-ts" tabindex="-1">Vite+Vue2+TS <a class="header-anchor" href="#vite-vue2-ts" aria-hidden="true">#</a></h1><blockquote><p><a href="https://zhuanlan.zhihu.com/p/447557046?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">Vite 生态发展的怎么样了</a><br><a href="https://zhuanlan.zhihu.com/p/424842555" target="_blank" rel="noopener noreferrer">Vite 介绍及实现原理</a><br><a href="https://blog.csdn.net/var_deng/article/details/120488439" target="_blank" rel="noopener noreferrer">vue2.x 项目 webpack 升级 vite 避坑总结</a><br><a href="https://juejin.cn/post/6997310696845213704" target="_blank" rel="noopener noreferrer">vue2 老项目使用 vite2 升级</a><br><a href="https://zhuanlan.zhihu.com/p/414318880?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">Vite+Vue2+Composition-api+<code>＜script setup＞</code>+TS 搭配如何开发项目？</a><br><a href="https://www.cnblogs.com/web-learn/p/15670257.html" target="_blank" rel="noopener noreferrer">关于 vite.config.js 相关配置</a><br><a href="https://zhuanlan.zhihu.com/p/463047434?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">什么是 vite + vue3 + ts 现代开发最佳实践？</a></p></blockquote><p><div class="table-of-contents"><ul><li><a href="#基础配置">基础配置</a><ul><li><a href="#模板-资源">模板&amp;资源</a></li><li><a href="#支持-setup-语法糖">支持 setup 语法糖</a></li><li><a href="#sass-配置">Sass 配置</a></li><li><a href="#配置全局-scss-变量">配置全局 scss 变量</a></li><li><a href="#mockjs-配置">mockjs 配置</a></li><li><a href="#国际化">国际化</a></li><li><a href="#图标">图标</a></li><li><a href="#配置-element-ui">配置 element-ui</a></li><li><a href="#vite-问题记录">vite 问题记录</a></li><li><a href="#不支持的">不支持的</a></li><li><a href="#生态">生态</a></li></ul></li><li><a href="#代码规范">代码规范</a></li><li><a href="#composition-api-实践">Composition API 实践</a><ul><li><a href="#该用-ref-还是-reactive">该用 ref 还是 reactive</a></li><li><a href="#重置表单">重置表单</a></li><li><a href="#调用子组件方法">调用子组件方法</a></li><li><a href="#组件之间状态共享">组件之间状态共享</a></li><li><a href="#如何使用全局方法、路由、vuex">如何使用全局方法、路由、Vuex</a></li></ul></li><li><a href="#composable">composable</a></li><li><a href="#vue2-typescript-实践">Vue2 TypeScript 实践</a><ul><li><a href="#typescript-怎么声明全局类型">TypeScript 怎么声明全局类型</a></li><li><a href="#用-type-还是-interface？">用 type 还是 interface？</a></li><li><a href="#类型声明文件">类型声明文件</a></li><li><a href="#volar-ts-在-vue-中提供更好的类型提示">Volar + TS 在 vue 中提供更好的类型提示</a></li><li><a href="#组件-props-类型校验">组件 props 类型校验</a></li><li><a href="#shims-vue-d-ts-文件的作用">shims-vue.d.ts 文件的作用</a></li><li><a href="#为-axios-增加泛型的支持">为 axios 增加泛型的支持</a></li><li><a href="#扩展-axios-config">扩展 axios config</a></li><li><a href="#自定义指令">自定义指令</a></li><li><a href="#导入-export-default-的文件">导入 export default 的文件</a></li><li><a href="#el-在-element-类型中不存在">$el 在 element 类型中不存在</a></li><li><a href="#eventtarget-类型">EventTarget 类型</a></li><li><a href="#隐式具有“any”类型">隐式具有“any”类型</a></li><li><a href="#获取对象所有的值的联合类型">获取对象所有的值的联合类型</a></li><li><a href="#模板过滤器问题">模板过滤器问题</a></li><li><a href="#其他问题">其他问题</a></li></ul></li><li><a href="#tsx-实践">TSX 实践</a><ul><li><a href="#配置-vite">配置 vite</a></li><li><a href="#遇到的问题">遇到的问题</a></li></ul></li><li><a href="#ie-兼容">IE 兼容</a><ul><li><a href="#js-兼容配置">js 兼容配置</a></li><li><a href="#css-兼容配置">css 兼容配置</a></li><li><a href="#element-ui-在-ie11-中报错">Element ui 在 ie11 中报错</a></li><li><a href="#svgicon-兼容性问题">svgIcon 兼容性问题</a></li></ul></li><li><a href="#vueuse-实践">vueUse 实践</a><ul><li><a href="#父子组件数据同步">父子组件数据同步</a></li><li><a href="#获取鼠标位置">获取鼠标位置</a></li></ul></li><li><a href="#打包上线">打包上线</a><ul><li><a href="#根据环境变量与模式打包项目">根据环境变量与模式打包项目</a></li><li><a href="#项目部署公共基础路径">项目部署公共基础路径</a></li><li><a href="#vite-config-js-中使用-import-meta-u200b-env">vite.config.js 中使用 import.<wbr>meta\u200b.env.*</a></li><li><a href="#html-中使用环境变量">html 中使用环境变量</a></li><li><a href="#打包文件路径">打包文件路径</a></li></ul></li></ul></div></p><h2 id="基础配置" tabindex="-1">基础配置 <a class="header-anchor" href="#基础配置" aria-hidden="true">#</a></h2><h3 id="模板-资源" tabindex="-1">模板&amp;资源 <a class="header-anchor" href="#模板-资源" aria-hidden="true">#</a></h3><p>Vite 官方默认模板是 Vue3 的，没有提供 Vue2 的模板。</p><p>第三方模板：</p><ul><li><p>pc 端模板 <a href="https://github.com/lstoeferle/vite-vue2-windicss-starter?ref=bestofvue.com" target="_blank" rel="noopener noreferrer">vite-vue2-windicss-starter</a></p></li><li><p>移动端模板 <a href="https://github.com/liugangtaotie/vite2-vue2-ts" target="_blank" rel="noopener noreferrer">vite2-vue2-ts-vant2</a> 移动端不用兼容 ie 可以上 vue3？</p></li><li><p>更多模板和 vite 相关资源 <a href="https://github.com/vitejs/awesome-vite#templates" target="_blank" rel="noopener noreferrer">awesome-vite#templates</a></p></li></ul><p><strong>问题</strong> vite-vue2-windicss-starter 模板配置提交 Eslint 报错：</p><div class="danger custom-block"><p class="custom-block-title">error</p><p>ESLint: 8.0.1 No files matching the pattern &quot;&#39;./src/*<em>/</em>.{js,ts,tsx,vue,md}&#39;&quot; were found. Please check for typing mistakes in the pattern.</p></div><p><strong>解决</strong> scripts lint 命令加参数 <code>--no-error-on-unmatched-pattern</code>，同时修改 eslint 匹配规则：</p><p><code>&quot;lint&quot;: &quot;eslint &#39;./src/\*_/_.{js,ts,tsx,vue,md}&#39; --no-error-on-unmatched-pattern&quot;</code><br><code>&quot;lint:fix&quot;: &quot;eslint --fix --ext .ts,.js,.vue src --no-error-on-unmatched-pattern&quot;,</code></p><h3 id="支持-setup-语法糖" tabindex="-1">支持 setup 语法糖 <a class="header-anchor" href="#支持-setup-语法糖" aria-hidden="true">#</a></h3><p><a href="https://v3.cn.vuejs.org/api/sfc-script-setup.html#%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95" target="_blank" rel="noopener noreferrer">官方文档：单文件组件 <code>&lt;script setup&gt;</code></a><br><a href="https://www.jb51.net/article/231485.htm#_lab2_3_2" target="_blank" rel="noopener noreferrer">强烈推荐!Vue3.2 中的 setup 语法糖</a><br><a href="https://juejin.cn/post/6941261566985650183" target="_blank" rel="noopener noreferrer">你不知道的<code>&lt;script setup&gt;</code>不完全攻略</a> 通过插件 <a href="https://github.com/antfu/unplugin-vue2-script-setup#readme" target="_blank" rel="noopener noreferrer">unplugin-vue2-script-setup</a> 支持。 <a href="https://github.com/antfu/unplugin-vue2-script-setup/tree/main/playground" target="_blank" rel="noopener noreferrer">官方示例</a></p><p>安装 Volar 禁用 Vetur。<br> 需要安装@vue/runtime-dom 为 devDependencies 才能使其在 Vue 2 上运行。</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> @vue/runtime-dom -D
</code></pre></div><p>支持 Vue 2 模板</p><div class="language-json"><pre><code><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;types&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;unplugin-vue2-script-setup/types&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;vueCompilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;experimentalCompatMode&quot;</span><span class="token operator">:</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-ts"><pre><code><span class="token comment">// vite.config.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createVuePlugin <span class="token keyword">as</span> Vue2 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-vue2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ScriptSetup <span class="token keyword">from</span> <span class="token string">&quot;unplugin-vue2-script-setup/vite&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">//</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">Vue2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">ScriptSetup</span><span class="token punctuation">(</span><span class="token punctuation">{</span> reactivityTransform<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>reactivityTransform:false</code> 关闭实验性 <a href="https://github.com/vuejs/rfcs/discussions/369" target="_blank" rel="noopener noreferrer">Ref Sugar（take 2）</a>实现。</p><div class="language-ts"><pre><code><span class="token comment">// shims-vue.d.ts</span>
<span class="token comment">/// &lt;reference types=&quot;unplugin-vue2-script-setup/shims.js&quot; /&gt;</span>
<span class="token comment">/// &lt;reference types=&quot;unplugin-vue2-script-setup/ref-macros.js&quot; /&gt;</span>
<span class="token operator">...</span>
</code></pre></div><p>修改 eslint 配置，支持 setup 全局的方法。 配置后 eslint 插件报错：<a href="https://stackoverflow.com/questions/69796772/what-is-causing-error-eslintrc-js-environment-key-vue-setup-compiler-macros/69806781" target="_blank" rel="noopener noreferrer">Environment key &quot;vue/setup-compiler-macros&quot; is unknown</a>。需要更新 eslint 和 eslint-plugin-vue，更新后重启 vscode。</p><div class="language-js"><pre><code><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/setup-compiler-macros&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题</strong> 如何获取当前实例？</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-demi&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> vm <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">?.</span>proxy<span class="token punctuation">;</span> <span class="token comment">// 相当于this</span>
</code></pre></div><p>vue3 在弱化 this，推荐使用 <code>{ useRoute, useRouter }</code> 通过 composable 的方式获取路由实例、store 等。目前在 vue2 中还是要使用 this。</p><h3 id="sass-配置" tabindex="-1">Sass 配置 <a class="header-anchor" href="#sass-配置" aria-hidden="true">#</a></h3><p>只要安装预处理器即可，自动开启 sass 支持 <a href="https://cn.vitejs.dev/guide/features.html#css-pre-processors" target="_blank" rel="noopener noreferrer">官方文档</a></p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> sass -D
</code></pre></div><h3 id="配置全局-scss-变量" tabindex="-1">配置全局 scss 变量 <a class="header-anchor" href="#配置全局-scss-变量" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">additionalData</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">@import &quot;@/styles/index.scss&quot;;</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="mockjs-配置" tabindex="-1">mockjs 配置 <a class="header-anchor" href="#mockjs-配置" aria-hidden="true">#</a></h3><p><a href="https://blog.51cto.com/u_15057858/4395719" target="_blank" rel="noopener noreferrer">vite 使用 mock 插件(vite-plugin-mock)</a><br><a href="https://blog.csdn.net/wuyujin1997/article/details/111656446" target="_blank" rel="noopener noreferrer">使用 mockjs 随机生成大批量常用字段的值(人名，年龄，地址，邮箱，日期……)</a><br> mock vite 配完后，按照 mockjs 规则写即可</p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> mockjs vite-plugin-mock -D
</code></pre></div><p>vite.config.js</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createVuePlugin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-vue2&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> viteMockServe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite-plugin-mock&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">createVuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">viteMockServe</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">mockPath</span><span class="token operator">:</span> <span class="token string">&quot;./src/mock&quot;</span><span class="token punctuation">,</span> <span class="token comment">//配置mock路径</span>
      <span class="token literal-property property">supportTs</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>mock/user.ts</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">&quot;/mock-server/users/info&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">timeout</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token function-variable function">response</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">code</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
        <span class="token literal-property property">message</span><span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="国际化" tabindex="-1">国际化 <a class="header-anchor" href="#国际化" aria-hidden="true">#</a></h3><p><a href="http://vuepress.wmm66.com/%E5%89%8D%E7%AB%AF%E5%BC%80%E5%8F%91/vue/%E5%9F%BA%E4%BA%8ETypescript%E7%9A%84vue%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE%E5%9B%BD%E9%99%85%E5%8C%96.html#%E7%AE%80%E4%BB%8B" target="_blank" rel="noopener noreferrer">Vue+TS 配置国际化</a> 除了配置项目的国际化，还需要配置 ui 框架的国际化</p><h3 id="图标" tabindex="-1">图标 <a class="header-anchor" href="#图标" aria-hidden="true">#</a></h3><p>vite-plugin-svg-icons 支持 vue2、3，不兼容 ie。<br> webpack 项目的 svgIcon 支持 ie。<br> unplugin-icons 由于墙的原因无法使用。<br> iconfont 没有问题。</p><h3 id="配置-element-ui" tabindex="-1">配置 element-ui <a class="header-anchor" href="#配置-element-ui" aria-hidden="true">#</a></h3><p>使用分解器自动按需引入</p><p>vite.config.js</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> ElementUiResolver<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;unplugin-vue-components/resolvers&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> ViteComponents <span class="token keyword">from</span> <span class="token string">&quot;unplugin-vue-components/vite&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">ViteComponents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">resolvers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">ElementUiResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//ElementUi组件按需自动导入</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这种方式按需引入，一些全局方法无法使用，如<code>this.$message</code>，需要单独引入手动挂载到 <code>Vue.prototype</code> 上</p><h4 id="组件全局设置-size-大小" tabindex="-1">组件全局设置 size 大小 <a class="header-anchor" href="#组件全局设置-size-大小" aria-hidden="true">#</a></h4><p>按需引入配置：<code>Vue.prototype.$ELEMENT = { size: &#39;small&#39;, zIndex: 3000 };</code><br> 全局引入配置：<code>Vue.use(Element, { size: &#39;small&#39;, zIndex: 3000});</code></p><p>使用分解其自动按需引入的方式，element 组件不会经过 legacy 处理，<strong>不兼容 ie</strong>，改为全量引入。</p><p><strong>问题</strong> 全量引入 element ui 的 css 打包报警告：<code>&quot;@charset&quot; must be the first rule in the file</code> 且会导致打包速度变慢。sass 编译的时候，因为被编译的文件里有中文，所以会这样。</p><p><strong>解决</strong> 移除@charset 规则直接在 vite.config.js 里配置，和 postcss.config.js 有冲突, 导致 postcss.config.js 里的插件不生效，修改或新建 postcss.config.js。</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">postcssPlugin</span><span class="token operator">:</span> <span class="token string">&quot;internal:charset-removal&quot;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">AtRule</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token function-variable function">charset</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">atRule</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>atRule<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&quot;charset&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            atRule<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>去除 charset 规则加快打包：Done in 39.63s.</p><p>在 vite.config.js 里面，加一个 sass 的配置，把 charset 关掉</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">charset</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>问题</strong> vite2 打包 sass 出现警告 Using / for division is deprecated。element ui 中使用了旧的语法，新版 sass 将会移除 <strong>解决</strong> 配置 vite 较少警告，或者降级到 <code>&quot;sass&quot;: &quot;1.32.12&quot;</code>，尽量使用原生支持的 calc()函数</p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">preprocessorOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">scss</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">quietDeps</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 减少sass警告 Using / for division is deprecated</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="vite-问题记录" tabindex="-1">vite 问题记录 <a class="header-anchor" href="#vite-问题记录" aria-hidden="true">#</a></h3><ul><li><p><a href="https://www.jianshu.com/p/5256c691d9bd" target="_blank" rel="noopener noreferrer">vite + moment.js 中文国际化失效</a></p><p>vite 只支持 ES modules</p><div class="language-ts"><pre><code><span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">&quot;moment&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;moment/dist/locale/zh-cn&quot;</span><span class="token punctuation">;</span>
moment<span class="token punctuation">.</span><span class="token function">locale</span><span class="token punctuation">(</span><span class="token string">&quot;zh-cn&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>sourcemap 丢失，打断点无法映射源码。 <strong>原因</strong> 某个依赖的问题 <strong>解决</strong> 恢复 &quot;unplugin-vue-components&quot;: &quot;^0.17.11&quot;版, 恢复 yarn.lock 解决依赖问题。</p></li></ul><h3 id="不支持的" tabindex="-1">不支持的 <a class="header-anchor" href="#不支持的" aria-hidden="true">#</a></h3><ul><li><p>scss js 变量共享 vite 好像不支持。<a href="https://cn.windicss.org/utilities/colors.html#customization" target="_blank" rel="noopener noreferrer">windicss 颜色主题</a> 和 scss 变量要分开配置，或者放弃 scss 变量，统一使用 windicss。</p></li><li><p>在 vite 中 vue 模板依然不支持可选链<code>?.</code>和空值合并<code>??</code>运算符。</p></li></ul><h3 id="生态" tabindex="-1">生态 <a class="header-anchor" href="#生态" aria-hidden="true">#</a></h3><ul><li>Vue Demi 这是一个让你可以开发同时支持 Vue2 和 3 的通用 Vue 库的开发工具。</li><li>VueUse 基本 Vue 组合实用程序的集合 5 个可以加速开发的 VueUse 函数库。</li><li>unplugin-vue-components <a href="https://vue-js.com/topic/61d7be4503eaf00040d48063" target="_blank" rel="noopener noreferrer">自动引入(组件,ui(Element-ui)库,vue hooks 等)</a></li><li>Vuesax 是基于 Vue.js 的 UI 框架，零开始设计，可以逐步采用。</li><li>Vue Volar Extension Pack 包含 12 个扩展。</li><li>Vue 3 Snippets 基于最新的 Vue 2 及 Vue 3 的 API 添加了 Code Snippets。</li></ul><h2 id="代码规范" tabindex="-1">代码规范 <a class="header-anchor" href="#代码规范" aria-hidden="true">#</a></h2><blockquote><p><a href="https://mp.weixin.qq.com/s/4Nr5Y-ngFVqw__J_yE_mkw" target="_blank" rel="noopener noreferrer">JavaScript 命名约定最佳实践</a> &gt; <a href="https://blog.csdn.net/biraotian/article/details/113629230" target="_blank" rel="noopener noreferrer">VUE 项目中的 commit 提交规范插件</a><br><a href="https://blog.csdn.net/weixin_45191649/article/details/109818249" target="_blank" rel="noopener noreferrer">Vue 的 ESLint-stylelint-prettier 联合配置</a><br><a href="https://eslint.vuejs.org/" target="_blank" rel="noopener noreferrer">eslint-plugin-vue 文档</a><br><a href="https://cn.vuejs.org/v2/style-guide/" target="_blank" rel="noopener noreferrer">Vue 风格指南</a><br><a href="https://zhuanlan.zhihu.com/p/81764012" target="_blank" rel="noopener noreferrer">prettier 与 Git 整合</a>：添加 lint-staged 提交代码时，使用 eslint fix 修复暂存的文件</p></blockquote><p>vue eslint 规则。模板组件名风格：帕斯卡，限制标签属性顺序 .eslintrc.js</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;plugin:vue/essential&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;eslint:recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/typescript/recommended&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@vue/prettier&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">RouteItem</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token string-property property">&quot;no-console&quot;</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;warn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;no-debugger&quot;</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&quot;production&quot;</span> <span class="token operator">?</span> <span class="token string">&quot;warn&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;off&quot;</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/component-name-in-template-casing&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;PascalCase&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">registeredComponentsOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token literal-property property">ignores</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//模板中组件名PascalCase，和类名保持一致</span>
    <span class="token string-property property">&quot;vue/name-property-casing&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PascalCase&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//组件名PascalCase</span>
    <span class="token string-property property">&quot;vue/match-component-file-name&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;vue&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">shouldMatchCase</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//要求组件name属性匹配其**文件名**</span>
    <span class="token string-property property">&quot;vue/prop-name-casing&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;camelCase&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//组件props camelCase</span>
    <span class="token string-property property">&quot;vue/this-in-template&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;never&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//不要在模版中使用this</span>
    <span class="token comment">//自定义事件名称始终使用kebab-case(短横线命名)</span>
    <span class="token string-property property">&quot;vue/custom-event-name-casing&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;kebab-case&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">&quot;vue/attribute-hyphenation&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token string">&quot;always&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">ignore</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//标签属性名称始终使用kebab-case(短横线命名)</span>
    <span class="token string-property property">&quot;vue/attributes-order&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&quot;error&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">order</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;DEFINITION&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;LIST_RENDERING&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;CONDITIONALS&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;RENDER_MODIFIERS&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;GLOBAL&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;UNIQUE&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;TWO_WAY_BINDING&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;OTHER_DIRECTIVES&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;OTHER_ATTR&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;EVENTS&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;CONTENT&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//标签属性、指令排序</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>.stylelintrc.js</p><div class="language-js"><pre><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stylelint-config-recess-order&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;stylelint-config-prettier&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="composition-api-实践" tabindex="-1">Composition API 实践 <a class="header-anchor" href="#composition-api-实践" aria-hidden="true">#</a></h2><blockquote><p><a href="https://blog.csdn.net/lhjuejiang/article/details/118542096" target="_blank" rel="noopener noreferrer">一文了解 Composition API 新特性：ref、toRef、toRefs</a><br><a href="https://zhuanlan.zhihu.com/p/408272742?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">JS 基础系列之 —— Composition API</a> Vue3 后台项目 <a href="https://github.com/vbenjs/vue-vben-admin/blob/next/README.zh-CN.md" target="_blank" rel="noopener noreferrer">vue-vben-admin</a></p></blockquote><p>在 vue2 中听过插件的方式使用组合式 API <a href="https://github.com/vuejs/composition-api" target="_blank" rel="noopener noreferrer">@vue/composition-api</a>，官方 README 中有一些注意事项，和 Vue3 中的 Composition API 相比，有一些缺失和差异。</p><h3 id="该用-ref-还是-reactive" tabindex="-1"><a href="https://www.bilibili.com/video/BV19Q4y1e75C?p=1&amp;share_medium=iphone_b&amp;share_plat=ios&amp;share_session_id=A798B558-752B-4F7A-A31A-A932E9C3C2F5&amp;share_source=WEIXIN&amp;share_tag=s_i&amp;timestamp=1641999797&amp;unique_k=o5mOAAI" target="_blank" rel="noopener noreferrer">该用 ref 还是 reactive</a> <a class="header-anchor" href="#该用-ref-还是-reactive" aria-hidden="true">#</a></h3><p>多数场景 ref 够用，注意不是所有变量都要 ref。<strong>注意</strong> 有些变量不需要转为响应式对象</p><ul><li>ref 的参数支持基本数据类型和引用类型</li><li>reactive 参数不能是基本数据类型</li></ul><h3 id="重置表单" tabindex="-1">重置表单 <a class="header-anchor" href="#重置表单" aria-hidden="true">#</a></h3><p>使用 Composition API 时，Element ui 时重置表单的方式：</p><ol><li>给 ref 的 value 赋值默认表单</li><li>reactive 使用 Object.assign 合并默认表单。</li><li>使用 el-form 的 resetFields 方法</li></ol><h3 id="调用子组件方法" tabindex="-1">调用子组件方法 <a class="header-anchor" href="#调用子组件方法" aria-hidden="true">#</a></h3><p>子组件需要在 setup 函数 return 的对象中暴露方法，<a href="https://www.5axxw.com/questions/content/zswwzk" target="_blank" rel="noopener noreferrer">Vue Composition Api-调用子组件的方法</a></p><h3 id="组件之间状态共享" tabindex="-1">组件之间状态共享 <a class="header-anchor" href="#组件之间状态共享" aria-hidden="true">#</a></h3><p><a href="https://zhuanlan.zhihu.com/p/320445941" target="_blank" rel="noopener noreferrer">是否应该使用 Composition API 替代 Vuex？</a></p><p>创建一个导出响应式变量的文件 stateTest.ts</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-demi&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>不同组件导入这个 state，就能实现状态共享了。任意一个组件改变状态，另一个组件的状态也会跟着变化</p><p>通过 provide 注入全局，可以实现类似 vuex 的效果。缺点是 vue-devtool 观察不到数据变化</p><h3 id="如何使用全局方法、路由、vuex" tabindex="-1">如何使用全局方法、路由、Vuex <a class="header-anchor" href="#如何使用全局方法、路由、vuex" aria-hidden="true">#</a></h3><p>参考 <a href="https://juejin.cn/post/6990543774552162340#heading-8" target="_blank" rel="noopener noreferrer">Vue 2 落地 TypeScript 指南</a> 引入 <a href="https://github.com/ambit-tsai/vue2-helpers#readme" target="_blank" rel="noopener noreferrer">vue2-helpers</a> 内部也是用了 <code>getCurrentInstance</code>，意义在于抹平语法差异，便于迁移。<a href="https://v3.cn.vuejs.org/api/composition-api.html#getcurrentinstance" target="_blank" rel="noopener noreferrer">不推荐在应用的代码中使用 <code>getCurrentInstance</code></a>。</p><ul><li><p><code>setup</code> 函数的第二个参数 <code>ctx</code> ， <code>ctx.root</code>可以当成 <code>this</code> 使用。<code>ctx.$message(&#39;msg&#39;)</code>。<code>vue3</code> 不推荐。</p></li><li><p><code>getCurrentInstance</code> 获取组件实例。<code>getCurrentInstance()?.proxy;</code> <code>proxy</code> 相当于 <code>this</code>。<code>vue3</code> 不推荐。</p></li><li><p><code>import Vue from &quot;vue&quot;; Vue.prototype.$message(&quot;111&quot;);</code> 将全局方法挂载到 vue 原型上。</p></li><li><p>直接导入 <code>store</code> 的方式使用 <code>Vuex</code>。</p></li><li><p>使用<a href="https://github.com/vuejs/pinia" target="_blank" rel="noopener noreferrer">pinia</a>替代 vuex。优势：符合直觉，易于学习；极轻， 仅有 1 KB；模块化设计，便于拆分状态</p></li><li><p>使用 vue2-helpers</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> useRouter<span class="token punctuation">,</span> useRoute<span class="token punctuation">,</span> useStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue2-helpers/vue-router&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">useRouter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要在 setup 中调用</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">useRoute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要在 setup 中调用</span>
<span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要在setup中执行</span>
</code></pre></div></li><li><p><code>vue2-helpers</code>实际上是对<code>getCurrentInstance</code>的封装，可以封装自己的 <code>vue2-helpers</code>。</p><div class="language-ts"><pre><code><span class="token comment">//utils</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> getCurrentInstance <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/composition-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token punctuation">{</span> warn <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token builtin">console</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token constant">OUT_OF_SCOPE</span> <span class="token operator">=</span>
  <span class="token string">&quot;getCurrentInstance() returned null. Method must be called at the top of a setup function&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getProp</span> <span class="token operator">=</span> <span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> inst <span class="token operator">=</span> <span class="token function">getCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>inst<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> inst<span class="token punctuation">.</span>proxy<span class="token punctuation">[</span>key <span class="token keyword">as</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> inst<span class="token punctuation">.</span>proxy<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">warn</span><span class="token punctuation">(</span><span class="token constant">OUT_OF_SCOPE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// eslint-disable-next-line @typescript-eslint/no-explicit-any</span>
  <span class="token keyword">return</span> <span class="token keyword">undefined</span> <span class="token keyword">as</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">useMessage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">getProp</span><span class="token punctuation">(</span><span class="token string">&quot;$message&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// **.vue 通过这种方式使用</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> useMessage <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@/utils&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> message <span class="token operator">=</span> <span class="token function">useMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//需要在setup中执行</span>
</code></pre></div></li></ul><h2 id="composable" tabindex="-1">composable <a class="header-anchor" href="#composable" aria-hidden="true">#</a></h2><p>将逻辑提取到 composable 函数中，避免逻辑堆积，导致组件文件过长，提高可读性和可维护性。</p><h2 id="vue2-typescript-实践" tabindex="-1">Vue2 TypeScript 实践 <a class="header-anchor" href="#vue2-typescript-实践" aria-hidden="true">#</a></h2><blockquote><p><a href="https://blog.csdn.net/qq_38277179/article/details/104446592" target="_blank" rel="noopener noreferrer">总结函数类型的定义方法</a><br> 从 <a href="https://github.com/element-plus/element-plus" target="_blank" rel="noopener noreferrer">element-plus 源码</a> 中学习 composition api 和 TypeScript</p></blockquote><h3 id="typescript-怎么声明全局类型" tabindex="-1">TypeScript 怎么声明全局类型 <a class="header-anchor" href="#typescript-怎么声明全局类型" aria-hidden="true">#</a></h3><ol><li>项目的话，直接项目中扔个 xx.d.ts 文件： declare const xx:any; 但是注意这个文件里不要出现 export import 等模块语法，否则会被当作 module 声明而非全局。</li><li>如果是公共包（比如发到 npm），declare namespace global ｛ ｝ 中声明即可</li></ol><p>在全局类型声明文件中引入其他模块 <a href="https://stackoverflow.com/questions/39040108/import-class-in-definition-file-d-ts" target="_blank" rel="noopener noreferrer">import class in definition file .d.ts</a></p><div class="language-ts"><pre><code><span class="token keyword">declare</span> <span class="token keyword">namespace</span> Express <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span>
    user<span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>User<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="用-type-还是-interface？" tabindex="-1">用 type 还是 interface？ <a class="header-anchor" href="#用-type-还是-interface？" aria-hidden="true">#</a></h3><p>interface 能实现就用 interface，否则用 type</p><h3 id="类型声明文件" tabindex="-1">类型声明文件 <a class="header-anchor" href="#类型声明文件" aria-hidden="true">#</a></h3><p><a href="https://zhuanlan.zhihu.com/p/103158789?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">ts 类型声明文件的正确使用姿势</a><br><a href="https://zhuanlan.zhihu.com/p/349595729?utm_source=wechat_session&amp;utm_medium=social&amp;utm_oi=35206853558272" target="_blank" rel="noopener noreferrer">在 TypeScript 中导入 JavaScript 包，解决声明文件报错问题</a><br><a href="https://www.cnblogs.com/leslie1943/p/13466943.html" target="_blank" rel="noopener noreferrer">TypeScript 在 vue 中定义全局类型</a><br> 类型声明文件统一放在/src/types 目录</p><h3 id="volar-ts-在-vue-中提供更好的类型提示" tabindex="-1">Volar + TS 在 vue 中提供更好的类型提示 <a class="header-anchor" href="#volar-ts-在-vue-中提供更好的类型提示" aria-hidden="true">#</a></h3><p><a href="https://juejin.cn/post/6966106927990308872#heading-0" target="_blank" rel="noopener noreferrer">Volar - vue 终极开发神器！</a><br><a href="https://juejin.cn/post/7043723576121229342" target="_blank" rel="noopener noreferrer">缺少 UI 库类型提示，你可能使用的是阉割版的 Volar+Vue</a></p><ul><li><p>在 vue 模板中，提供更好的类型提示。</p></li><li><p>UI 组件：要看有没有提供类型声明文件。</p><p>vue2 的 element ui 不是用 TS 写的，组件没有类型提示，需要自定义类型声明文件：</p><div class="language-ts"><pre><code><span class="token comment">// GlobalComponents for Volar 为 Volar 准备的声明文件</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;vue&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">GlobalComponents</span> <span class="token punctuation">{</span>
    ElButton<span class="token operator">:</span> <span class="token keyword">typeof</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;element-plus&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;ElButton&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// vue3</span>
    ElButton<span class="token operator">:</span> <span class="token keyword">typeof</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;element-ui&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">&quot;Button&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//vue2</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>vue2 版本定义完类型声明文件，提示：<code>(property) ElButton: typeof Button</code>。<br> vue3 的 element ui，提供了 global.d.ts。鼠标悬停在组件上可以显示它有哪些属性。</p></li><li><p>自定义组件：手动引入的 TS 写的组件，自动提供类型提示。全局组件需要像 UI 组件一样定义全局组件类型声明文件。vite 提供了配置项，可以自动生成该文件。借助插件 <a href="https://github.com/antfu/unplugin-vue-componentss" target="_blank" rel="noopener noreferrer">unplugin-vue-components</a></p><div class="language-js"><pre><code><span class="token function">ViteComponents</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">dirs</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;src/components&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//自动导入自己的组件，默认src/components</span>
  <span class="token literal-property property">dts</span><span class="token operator">:</span> <span class="token string">&quot;src/types/components.d.ts&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 生成类型声明文件</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul><h3 id="组件-props-类型校验" tabindex="-1">组件 props 类型校验 <a class="header-anchor" href="#组件-props-类型校验" aria-hidden="true">#</a></h3><p>第一种方式：使用 vue 的 props 校验+vue 提供的 PropType 增强校验，可以有默认值。</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> PropType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue-demi&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">routes</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> Array <span class="token keyword">as</span> PropType<span class="token operator">&lt;</span>RouteItem<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span> <span class="token punctuation">.</span> <span class="token punctuation">.</span>
</code></pre></div><p>第二种方式：使用 setup 语法糖 + TS 进行类型校验 <strong>推荐</strong></p><div class="language-ts"><pre><code><span class="token comment">// withDefaults、defineProps 不需要导入 网上文章有误，参考官方文档</span>

<span class="token keyword">interface</span> <span class="token class-name">IProps</span> <span class="token punctuation">{</span>
  field1<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> <span class="token comment">// ?: 可选属性</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> props <span class="token operator">=</span> <span class="token function">withDefaults</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">defineProps</span><span class="token generic class-name"><span class="token operator">&lt;</span>IProps<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  field1<span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 默认值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="shims-vue-d-ts-文件的作用" tabindex="-1">shims-vue.d.ts 文件的作用 <a class="header-anchor" href="#shims-vue-d-ts-文件的作用" aria-hidden="true">#</a></h3><p>shims-vue.d.ts 是为了 typescript 做的适配定义文件，因为.vue 文件不是一个常规的文件类型，ts 是不能理解 vue 文件是干嘛的，加这一段是是告诉 ts，vue 文件是这种类型的。</p><p>这一段删除，会发现 import 的所有 vue 类型的文件都会报错。</p><h3 id="为-axios-增加泛型的支持" tabindex="-1">为 axios 增加泛型的支持 <a class="header-anchor" href="#为-axios-增加泛型的支持" aria-hidden="true">#</a></h3><p>axios 请求返回的类型是 any，这时我们对请求后的数据进行操作时，没有享受到 ts 带来的类型提示，这时我们要做的就是重新声明 axios 模块：新建一个 shims-axios.d.ts，然后在调用时加上泛型。</p><div class="language-ts"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosRequestConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;axios&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">interface</span> <span class="token class-name">AxiosInstance</span> <span class="token punctuation">{</span>
    <span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">request</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>config<span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">get</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token keyword">delete</span><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">head</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">post</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
      url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
      data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
      config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">put</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
      url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
      data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
      config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token generic-function"><span class="token function">patch</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">any</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
      url<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span>
      data<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">,</span>
      config<span class="token operator">?</span><span class="token operator">:</span> AxiosRequestConfig
    <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="扩展-axios-config" tabindex="-1">扩展 axios config <a class="header-anchor" href="#扩展-axios-config" aria-hidden="true">#</a></h3><p>让 axios 支持自定义 config：</p><div class="language-ts"><pre><code><span class="token comment">// shims-axios.d.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> AxiosRequestConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// 扩展配置</span>
<span class="token keyword">interface</span> <span class="token class-name">AxiosRequestConfigExtend</span> <span class="token keyword">extends</span> <span class="token class-name">AxiosRequestConfig</span> <span class="token punctuation">{</span>
  customErr<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span> <span class="token comment">//手动处理错误</span>
<span class="token punctuation">}</span>
</code></pre></div><p>如何获取 axios 的自定义 config？<br><code>request</code> 拦截器在 <code>config</code> 中获取自定义属性。<br><code>response</code> 拦截器在 <code>error.response.config</code> 或 <code>response.config</code> 中获取自定义属性。</p><h3 id="自定义指令" tabindex="-1">自定义指令 <a class="header-anchor" href="#自定义指令" aria-hidden="true">#</a></h3><p>组件引入自定义指令时 <code>directives: { draggable }</code>，模板报错，变量找不到名称 xxx，改为 setup 可以解决？ 换一种写法解决 <code>directives: { draggable: { ...draggable } }</code>。<br><a href="https://juejin.cn/post/6894518151686389774" target="_blank" rel="noopener noreferrer">使用 Vue、TS 编写一个自定义长按指令</a></p><h3 id="导入-export-default-的文件" tabindex="-1">导入 export default 的文件 <a class="header-anchor" href="#导入-export-default-的文件" aria-hidden="true">#</a></h3><p>类型报错：<code>&quot;default”隐式具有类型 &quot;any&quot;，因为它不具有类型批注，且在其自身的初始化表达式中得到直接或间接引用。</code><br> 使用 <code>as</code> 进行对 <code>import</code> 的内容进行类型转换。</p><h3 id="el-在-element-类型中不存在" tabindex="-1">$el 在 element 类型中不存在 <a class="header-anchor" href="#el-在-element-类型中不存在" aria-hidden="true">#</a></h3><p><a href="https://segmentfault.com/q/1010000019458114" target="_blank" rel="noopener noreferrer">TS 报错：$el 在 element 类型中不存在</a></p><p><code>let elem = (this.$refs.nav as Vue).$el;</code></p><h3 id="eventtarget-类型" tabindex="-1">EventTarget 类型 <a class="header-anchor" href="#eventtarget-类型" aria-hidden="true">#</a></h3><blockquote><p><a href="https://segmentfault.com/q/1010000039692067" target="_blank" rel="noopener noreferrer">为什么 EventTarget 类型上比 HTMLElement 类型少那么多属性?</a><br> 因为 <code>EventTarget</code> 是一个抽象基类，所有事件的触发都会有一个 <code>EventTarget</code>，甚至不一定是一个 <code>DOM</code> 对象（比如可能是一个 <code>VideoContext</code> 或者 <code>WebSocket</code>）</p></blockquote><p>遇到报错时进行类型转换 <code>e.target as HTMLElement</code></p><h3 id="隐式具有“any”类型" tabindex="-1">隐式具有“any”类型 <a class="header-anchor" href="#隐式具有“any”类型" aria-hidden="true">#</a></h3><p>元素隐式具有“any”类型，因为“string”类型的表达式不能用于索引类型。通过类型转换解决：</p><div class="language-ts"><pre><code>field <span class="token keyword">as</span> <span class="token keyword">keyof</span> <span class="token keyword">typeof</span> messages<span class="token punctuation">;</span>
<span class="token punctuation">(</span>args<span class="token operator">:</span> <span class="token keyword">typeof</span> xxx<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p><code>keyof</code> 该操作符可以用于获取某种类型的所有键，其返回类型是联合类型<br><code>typeof</code> 可以 获取一个值的类型，通过这个类型进行声明</p><h3 id="获取对象所有的值的联合类型" tabindex="-1">获取对象所有的值的联合类型 <a class="header-anchor" href="#获取对象所有的值的联合类型" aria-hidden="true">#</a></h3><div class="language-ts"><pre><code><span class="token keyword">type</span> <span class="token class-name">ValueOf<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">type</span> <span class="token class-name">Foo</span> <span class="token operator">=</span> <span class="token punctuation">{</span> a<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span> b<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">ValueOfFoo</span> <span class="token operator">=</span> ValueOf<span class="token operator">&lt;</span>Foo<span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// string | number</span>
</code></pre></div><h3 id="模板过滤器问题" tabindex="-1">模板过滤器问题 <a class="header-anchor" href="#模板过滤器问题" aria-hidden="true">#</a></h3><ul><li><p>ts 报未定义。声明全局变量 global.d.ts</p><div class="language-ts"><pre><code><span class="token keyword">declare</span> <span class="token keyword">const</span> $msg<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token function-variable function">selectEcho</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> <span class="token keyword">const</span> <span class="token function-variable function">fdate</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>过滤器 | ts 报：算术运算左侧必须是 &quot;any&quot;、&quot;number&quot;、&quot;bigint&quot; 或枚举类型。<a href="https://v3.cn.vuejs.org/guide/migration/filters.html" target="_blank" rel="noopener noreferrer">vue3 已经移除过滤器</a>。建议用方法调用或计算属性来替换它们。或者将数据转 any 抑制报错。</p></li></ul><h3 id="其他问题" tabindex="-1">其他问题 <a class="header-anchor" href="#其他问题" aria-hidden="true">#</a></h3><ul><li><p>组件改名后 <code>import { getImg } from &quot;@/utils&quot;;</code> ts 报找不到模块的类型声明。<br><strong>原因</strong> 只改了大小写。系统对文件名大小写是不敏感的。这样导致一系列的问题，git 也会有问题。<br><strong>解决</strong> 起一个新名字。或者其一个临时的名字，提交后再改回去。</p></li><li><p><code>export default []</code> 的类型推导问题。解决：声明一个中间变量接一下。</p><div class="language-ts"><pre><code><span class="token keyword">const</span> userCenter <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> userCenter<span class="token punctuation">;</span>
</code></pre></div></li><li><p><a href="https://v3.cn.vuejs.org/api/sfc-script-setup.html#defineprops-%E5%92%8C-defineemits" target="_blank" rel="noopener noreferrer">纯 ts 的方式</a>定义事件，会导致 volar 的组件类型提示失效。 <strong>解决</strong> 改用不传泛型参数的方式声明。</p><div class="language-ts"><pre><code><span class="token comment">// 定义事件</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token function">defineEmits</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;input&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ts方式声明事件导致volar组件类型提示失效</span>
<span class="token keyword">const</span> emit <span class="token operator">=</span> <span class="token generic-function"><span class="token function">defineEmits</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token string">&quot;input&quot;</span><span class="token punctuation">,</span> val<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>此表达式不可构造，类型 <code>&quot;typeof import(&quot;jsencrypt&quot;)&quot;</code> 没有构造签名。模块中需要 <code>default</code> 导出</p><div class="language-ts"><pre><code><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">&quot;jsencrypt&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">JSEncrypt</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setPublicKey</span><span class="token punctuation">(</span>pk<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
    <span class="token function">encrypt</span><span class="token punctuation">(</span>key<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> JSEncrypt<span class="token punctuation">;</span> <span class="token comment">//需要导出</span>
<span class="token punctuation">}</span>
</code></pre></div></li></ul><h2 id="tsx-实践" tabindex="-1">TSX 实践 <a class="header-anchor" href="#tsx-实践" aria-hidden="true">#</a></h2><blockquote><p><a href="https://github.com/caoxiemeihao/vite-vue2-tsx-composition-api" target="_blank" rel="noopener noreferrer">vite-vue2-tsx-composition-api</a> 项目混用 vue-cli 和 vite<br><a href="http://soiiy.com/index.php/Vue-js/13783.html" target="_blank" rel="noopener noreferrer">vite2 + vue2 + tsx + pinia 实战总结</a><br><a href="https://juejin.cn/post/6957881662302584839" target="_blank" rel="noopener noreferrer">Vue2.x 开启 Composition API、tsx</a><br><a href="https://www.jianshu.com/p/9616745a8d0a" target="_blank" rel="noopener noreferrer">在 Vue 中使用 JSX</a><br><a href="https://juejin.cn/post/6972094589251354632#heading-10" target="_blank" rel="noopener noreferrer">Vite + Vue 3 + tsx</a><br><a href="https://cn.vuejs.org/v2/guide/render-function.html#ad" target="_blank" rel="noopener noreferrer">渲染函数 &amp; JSX</a> 官方文档</p></blockquote><h3 id="配置-vite" tabindex="-1">配置 vite <a class="header-anchor" href="#配置-vite" aria-hidden="true">#</a></h3><div class="language-js"><pre><code><span class="token function">createVuePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">jsx</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="遇到的问题" tabindex="-1">遇到的问题 <a class="header-anchor" href="#遇到的问题" aria-hidden="true">#</a></h3><ol><li><p><code>vue2</code> <code>setup</code> 中写 <code>tsx</code> 报错：<code>Cannot read property &#39;$createElement&#39; of undefined 等。setup 中不支持 (setup 中没有 this) tsx</code></p><p>解决：写在 <code>render</code> 选项中，或者引入 <a href="https://github.com/luwanquan/babel-preset-vca-jsx" target="_blank" rel="noopener noreferrer">babel-preset-vca-jsx</a></p></li><li><p>jsx 中用帕斯卡 PascalCase 风格 element 组件标签， ts 报：未定义变量</p><p>解决：手动引入 <code>element ui</code> 组件</p></li><li><p>配置组件属性，TS 报错：<code>“(options?: ThisTypedComponentOptionsWithArrayProps&lt;Vue, object, object, object, never&gt; | undefined): Col”</code>错误。 解决：修改 shims-tsx.d.ts 类型声明文件：</p><div class="language-ts"><pre><code><span class="token keyword">import</span> Vue<span class="token punctuation">,</span> <span class="token punctuation">{</span> VNode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Vue<span class="token punctuation">,</span> <span class="token punctuation">{</span> VNode <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ComponentRenderProxy <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@vue/composition-api&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">declare</span> global <span class="token punctuation">{</span>
  <span class="token keyword">namespace</span> <span class="token constant">JSX</span> <span class="token punctuation">{</span>
    <span class="token keyword">interface</span> <span class="token class-name">Element</span> <span class="token keyword">extends</span> <span class="token class-name">VNode</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">ElementClass</span> <span class="token keyword">extends</span> <span class="token class-name">ComponentRenderProxy</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">ElementAttributesProperty</span> <span class="token punctuation">{</span>
      $props<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">unknown</span><span class="token operator">&gt;</span><span class="token punctuation">;</span> <span class="token comment">// specify the property name to use</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">IntrinsicElements</span> <span class="token punctuation">{</span>
      <span class="token punctuation">[</span>elem<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">interface</span> <span class="token class-name">ImportMeta</span> <span class="token punctuation">{</span>
      env<span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">any</span><span class="token punctuation">,</span> <span class="token builtin">string</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
      <span class="token generic-function"><span class="token function">globEager</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token operator">=</span> <span class="token builtin">unknown</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>globPath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> Record<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token constant">T</span><span class="token operator">&gt;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></li><li><p>TS 报错 <code>(method) render?(createElement: CreateElement, hack: RenderContext&lt;DefaultProps&gt;): VNode</code> 没有与此调用匹配的重载。未解决</p></li></ol><h2 id="ie-兼容" tabindex="-1">IE 兼容 <a class="header-anchor" href="#ie-兼容" aria-hidden="true">#</a></h2><p>默认不兼容 IE，配置 <code>Vite</code> 兼容 IE 后，打包速度变慢</p><h3 id="js-兼容配置" tabindex="-1">js 兼容配置 <a class="header-anchor" href="#js-兼容配置" aria-hidden="true">#</a></h3><p><a href="https://www.codeleading.com/article/62956091258/" target="_blank" rel="noopener noreferrer">vite 兼容 IE、低版本浏览器方法</a></p><div class="language-bash"><pre><code><span class="token function">yarn</span> <span class="token function">add</span> @vitejs/plugin-legacy -D
</code></pre></div><p>兼容 IE11 配置 vite.config.js</p><div class="language-js"><pre><code><span class="token keyword">import</span> legacy <span class="token keyword">from</span> <span class="token string">&quot;@vitejs/plugin-legacy&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">legacy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;ie &gt;= 11&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">additionalLegacyPolyfills</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;regenerator-runtime/runtime&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="css-兼容配置" tabindex="-1">css 兼容配置 <a class="header-anchor" href="#css-兼容配置" aria-hidden="true">#</a></h3><p>用了 windi.css ie 不兼容，部分样式丢失，解决方式：使用 <a href="https://github.com/nuxodin/ie11CustomProperties" target="_blank" rel="noopener noreferrer">CSS Variables Polyfill for IE11</a></p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span>MSInputMethodContext <span class="token operator">&amp;&amp;</span>
    document<span class="token punctuation">.</span>documentMode <span class="token operator">&amp;&amp;</span>
    document<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>
      <span class="token string">&#39;&lt;script src=&quot;https://cdn.jsdelivr.net/gh/nuxodin/ie11CustomProperties@4.1.0/ie11CustomProperties.min.js&quot;&gt;&lt;\/script&gt;&#39;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>放在项目的 public 目录 public\static\js\ie11CustomProperties.min.js</p><div class="language-html"><pre><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>/static/js/ie11CustomProperties.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>&lt;\/script&gt;
</code></pre></div><h3 id="element-ui-在-ie11-中报错" tabindex="-1">Element ui 在 ie11 中报错 <a class="header-anchor" href="#element-ui-在-ie11-中报错" aria-hidden="true">#</a></h3><p>使用解析器 ElementUiResolver 自动按需加载，打包时出问题：不会经过 @vitejs/plugin-legacy 解决方式：改为全局引入 element ui<br><a href="https://github.com/antfu/unplugin-vue-components/issues/212" target="_blank" rel="noopener noreferrer">issue</a></p><h3 id="svgicon-兼容性问题" tabindex="-1">svgIcon 兼容性问题 <a class="header-anchor" href="#svgicon-兼容性问题" aria-hidden="true">#</a></h3><p>IE 不兼容 vite 的 svg 图标，无法显示。改为字体图标，用法和 webpack 构建的项目一样</p><p><code>import &quot;@/assets/icon/iconfont.css&quot;;</code></p><h2 id="vueuse-实践" tabindex="-1">vueUse 实践 <a class="header-anchor" href="#vueuse-实践" aria-hidden="true">#</a></h2><h3 id="父子组件数据同步" tabindex="-1">父子组件数据同步 <a class="header-anchor" href="#父子组件数据同步" aria-hidden="true">#</a></h3><p><a href="https://vueuse.org/core/usevmodel/" target="_blank" rel="noopener noreferrer">https://vueuse.org/core/usevmodel/</a></p><p>使用方式：</p><ol><li><p>子组件通过 <code>vueUse</code> 发布事件 <code>@update:value</code></p><div class="language-js"><pre><code><span class="token keyword">const</span> activeIndex <span class="token operator">=</span> <span class="token function">useVModel</span><span class="token punctuation">(</span>props<span class="token punctuation">,</span> <span class="token string">&quot;value&quot;</span><span class="token punctuation">,</span> emit<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>同 <code>emit(&#39;update:value&#39;, value)</code></p></li><li><p>子组件 <code>props</code> 定义一个 <code>value</code> 属性</p></li><li><p>父组件使用 <code>value.sync = &quot;xxx&quot;</code> 绑定到要改的值 同 <code>@update:value=&quot;value =&gt; this.xxx = value&quot;</code></p></li></ol><p>和自定义 v-model 有点不同，v-model 在子组件需要定义 model 选项</p><h3 id="获取鼠标位置" tabindex="-1">获取鼠标位置 <a class="header-anchor" href="#获取鼠标位置" aria-hidden="true">#</a></h3><p><a href="https://vueuse.org/core/useMouse/" target="_blank" rel="noopener noreferrer">https://vueuse.org/core/useMouse/</a></p><h2 id="打包上线" tabindex="-1">打包上线 <a class="header-anchor" href="#打包上线" aria-hidden="true">#</a></h2><blockquote><p><a href="https://juejin.cn/post/6844903816375074830" target="_blank" rel="noopener noreferrer">vue 自动化部署 jenkins 篇</a><br><a href="https://juejin.cn/post/6994310850290909214" target="_blank" rel="noopener noreferrer">vite 根据环境变量与模式打包项目</a><br><a href="https://cn.vitejs.dev/guide/env-and-mode.html#modes" target="_blank" rel="noopener noreferrer">vite 环境变量与模式</a></p></blockquote><h3 id="根据环境变量与模式打包项目" tabindex="-1">根据环境变量与模式打包项目 <a class="header-anchor" href="#根据环境变量与模式打包项目" aria-hidden="true">#</a></h3><p>通过 <code>--mode test</code> 选项标志传递模式，来覆盖命令使用的默认模式</p><p>在 vue 里使用，比如：</p><div class="language-js"><pre><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;VITE_APP_TITLE:&quot;</span> <span class="token operator">+</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APP_TITLE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><strong>注意</strong> 字符串不能直接用 <code>import.<wbr>meta.env.</code>的方式使用，不然打包的时候会报错，可以用 <code>import.<wbr>meta\u200b.env.VITE_APP_TITLE</code> 的方式使用。比如下面的标题 <strong>vite.config.js 中使用 <code>import.<wbr>meta.env.*</code></strong>，导致打包报错。</p><h3 id="项目部署公共基础路径" tabindex="-1">项目部署公共基础路径 <a class="header-anchor" href="#项目部署公共基础路径" aria-hidden="true">#</a></h3><p>就是下文的 <code>base</code> 路径</p><p>涉及 <code>vue-router</code> 和 <code>vite</code> 配置<br><a href="https://vitejs.cn/guide/build.html#public-base-path" target="_blank" rel="noopener noreferrer">https://vitejs.cn/guide/build.html#public-base-path</a><br><a href="https://router.vuejs.org/zh/api/#base" target="_blank" rel="noopener noreferrer">https://router.vuejs.org/zh/api/#base</a></p><h3 id="vite-config-js-中使用-import-meta-u200b-env" tabindex="-1"><a href="https://www.jianshu.com/p/4973bd983e96" target="_blank" rel="noopener noreferrer">vite.config.js 中使用 <code>import.<wbr>meta\u200b.env.*</code></a> <a class="header-anchor" href="#vite-config-js-中使用-import-meta-u200b-env" aria-hidden="true">#</a></h3><p>需求：不同环境配置不同的 base 路径，发布到不同的目录</p><p>无法像 <code>vue-cli</code> 一样直接取到环境变量，原因是鸡生蛋的问题：</p><blockquote><p>There&#39;s a chicken-egg problem here: Vite expects to resolve .env files from project root, but project root can be made different by the config file. So if we resolve。 env before resolving the config file, we can only resolve it from CWD, which would then break the case where the user puts .env files in a nested root specified via config.</p></blockquote><p>第一种方式：写法要做一点改变，套了一层函数</p><div class="language-js"><pre><code><span class="token keyword">import</span> <span class="token punctuation">{</span> loadEnv <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vite&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token function">loadEnv</span><span class="token punctuation">(</span>mode<span class="token punctuation">,</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token constant">VITE_APP_BASE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>第二种方式：<code>dotenv</code> 需要单独 <code>npm install</code></p><div class="language-js"><pre><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> mode <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;dotenv&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">path</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./.env.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mode<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// now you can access config with process.<wbr>env.{configName}</span>
  <span class="token keyword">return</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">VITE_APP_BASE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="html-中使用环境变量" tabindex="-1">html 中使用环境变量 <a class="header-anchor" href="#html-中使用环境变量" aria-hidden="true">#</a></h3><p><code>vite-plugin-html-env</code></p><p><strong>注意</strong> 配置 <code>base</code> 发布路径后 <code>html</code> 中的路径会自动处理，<code>js</code>中的路径不会处理，可以使用外置文件引入 js，<code>&lt;script&gt;</code> 标签的路径会被自动修正，一般用不上这个插件。</p><h3 id="打包文件路径" tabindex="-1">打包文件路径 <a class="header-anchor" href="#打包文件路径" aria-hidden="true">#</a></h3><p><a href="https://juejin.cn/post/6989475484551610381" target="_blank" rel="noopener noreferrer">vite.config.js 配置踩坑</a></p><ul><li><p>打包后静态资源路径不对，封装一个方法：获取 img 目录下图片的动态路径</p><div class="language-ts"><pre><code><span class="token comment">/**
 * @param name 图片名称
 * @param format 图片格式 默认png
 */</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> getImg <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> format <span class="token operator">=</span> <span class="token string">&quot;png&quot;</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/src/assets/img/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>format<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> modules <span class="token operator">=</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">globEager</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token punctuation">{</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token builtin">string</span> <span class="token punctuation">}</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>
    <span class="token string">&quot;/src/assets/img/*&quot;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> modules<span class="token punctuation">[</span>path<span class="token punctuation">]</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li><li><p>打包后静态资源文件分类存放</p><div class="language-js"><pre><code><span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">build</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">assetsDir</span><span class="token operator">:</span> <span class="token string">&quot;static/img/&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rollupOptions</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">chunkFileNames</span><span class="token operator">:</span> <span class="token string">&quot;static/js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">&quot;static/js/[name]-[hash].js&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">assetFileNames</span><span class="token operator">:</span> <span class="token string">&quot;static/[ext]/[name]-[hash].[ext]&quot;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div></li></ul></div></div><footer class="page-footer" data-v-7eddb2c4 data-v-fb8d84c6><div class="edit" data-v-fb8d84c6><div class="edit-link" data-v-fb8d84c6 data-v-1ed99556><a class="link" href="https://github.com/1103409364/note-x/edit/main/docs/frontEnd/Vue/ViteVue2TS.md" target="_blank" rel="noopener noreferrer" data-v-1ed99556>为此页提供修改建议 <svg class="icon outbound icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15" data-v-1ed99556><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div></div><div class="updated" data-v-fb8d84c6><!----></div></footer><div class="next-and-prev-link" data-v-7eddb2c4 data-v-38ede35f><div class="container" data-v-38ede35f><div class="prev" data-v-38ede35f><a class="link" href="/note-x/frontEnd/Vue/" data-v-38ede35f><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-prev" data-v-38ede35f><path d="M19,11H7.4l5.3-5.3c0.4-0.4,0.4-1,0-1.4s-1-0.4-1.4,0l-7,7c-0.1,0.1-0.2,0.2-0.2,0.3c-0.1,0.2-0.1,0.5,0,0.8c0.1,0.1,0.1,0.2,0.2,0.3l7,7c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3c0.4-0.4,0.4-1,0-1.4L7.4,13H19c0.6,0,1-0.4,1-1S19.6,11,19,11z"></path></svg><span class="text" data-v-38ede35f>Vue</span></a></div><div class="next" data-v-38ede35f><a class="link" href="/note-x/frontEnd/Vue/Vue踩坑记录" data-v-38ede35f><span class="text" data-v-38ede35f>Vue 踩坑记录</span><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="icon icon-next" data-v-38ede35f><path d="M19.9,12.4c0.1-0.2,0.1-0.5,0-0.8c-0.1-0.1-0.1-0.2-0.2-0.3l-7-7c-0.4-0.4-1-0.4-1.4,0s-0.4,1,0,1.4l5.3,5.3H5c-0.6,0-1,0.4-1,1s0.4,1,1,1h11.6l-5.3,5.3c-0.4,0.4-0.4,1,0,1.4c0.2,0.2,0.5,0.3,0.7,0.3s0.5-0.1,0.7-0.3l7-7C19.8,12.6,19.9,12.5,19.9,12.4z"></path></svg></a></div></div></div><!--[--><!--]--></div></main></div><!----><!--]--></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"backend_index.md\":\"5fdb249a\",\"devops_index.md\":\"c85127a4\",\"frontend_css_advanced.md\":\"c3b42f35\",\"frontend_css_index.md\":\"6718f699\",\"frontend_html_advanced.md\":\"cce12baa\",\"frontend_html_basic.md\":\"98ebade9\",\"frontend_html_index.md\":\"7662b6ad\",\"frontend_javascript_javascript基础.md\":\"648bfedc\",\"frontend_javascript_javascript进阶.md\":\"16805029\",\"frontend_javascript_index.md\":\"2987ac4e\",\"frontend_javascript_问题记录.md\":\"04e81093\",\"frontend_vue_elementui2踩坑记录.md\":\"1dec5e51\",\"frontend_vue_vitevue2ts.md\":\"51a24954\",\"frontend_vue_vue踩坑记录.md\":\"4ea150df\",\"frontend_vue_index.md\":\"ecafe494\",\"frontend_engineered_index.md\":\"3d18d77b\",\"frontend_index.md\":\"095696cb\",\"index.md\":\"583a83ee\",\"others_index.md\":\"011dea50\",\"others_markdown_vscode配置markdown环境.md\":\"38110312\",\"others_markdown_index.md\":\"0361b7ab\",\"others_vitepress_vitepress配置.md\":\"3fd5e98d\",\"others_vitepress_index.md\":\"f4e11aed\",\"versioncontrol_index.md\":\"66f1d6ca\"}")</script>
    <script type="module" async src="/note-x/assets/app.81ce267e.js"></script>
    
  </body>
</html>